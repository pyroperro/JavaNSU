# Задание 3. Шаблон проектирования «MVC», графический интерфейс пользователя (GUI).
**Условие.** Написать аналог игры «Тетрис» (“Tetris”). Набор фигур стандартный – все возможные
вариации связных многоугольников, составленных из 4-х квадратов. Архитектура
программы должна быть основана на паттерне MVC (Mode-View-Controller).
**Требования к программе**
1. Игра должна поддерживать таблицу рекордов.
2. Пользователю должны быть доступны команды: Exit, About, New Game, High Scores.
## Архитектура
Структурно программа разделяется на два подпакета: `model`, отвечающий за логику игры и `gui`, занимающийся графическим интерфейсом игры.

![Tetris Gameplay](https://i.ibb.co/fYvg0BmF/tetris.png)
### Пакет `tetris.model`
#### 1. `TetrominoType.java`
Enum-класс, используется для задания начальных положений тетромино и  сохранения нужных цветов (кодов) в таблице игрового поля. Соответственно, имеет два поля:
- `private final boolean[][] shape;` содержит начальную "форму" тетрамино.
- `private final int colorCode;` хранит код цвета
  Позволяет получить форму и цвет любой из фигур тетрамино.

#### 2. `TetrominoBag.java`
Известно, что порядок фигур в тетрисе не является полностью случайным. Для более честной игры используется система **7-bag**.  Данный класс полностью берет на себя управление порядком тетрамино, его реализация основана на структуре данных `ArrayList`. Предоставляет следующие методы.
- `public TetrominoType getNextPiece()`  передает следующий в очереди тип тетрамино
-  `public List<TetrominoType> previewNext(int count)`  выдает count следующий тетрамино, нужен для реализации превью очереди

#### 3. `Tetromino.java`
Данный класс реализует "активное" тетрамино на поле, которым управляет игрок. Соответственно, обладает двумя полями: тип тетрамино (для получения кода цвета), двумерный массив `boolean` для хранения формы (в т.ч. повернутой) и `Point pos` координаты позиции фигуры на поле. Предоставляет набор геттеров и два метода поворота --- получение формы повернутой фигуры (для предварительных проверок) и непосредственно поворот фигуры.
#### 4. `GameField.java`

Класс `GameField` является центральной частью логики игры и отвечает за:

-   **Инициализацию поля.** Создает игровое поле фиксированного размера (ширина 10, высота 22) и управляет размещением фигур.
-   **Управление очередью фигур.** С помощью объекта `TetrominoBag` обеспечивает выдачу следующей фигуры и превью будущих фигур.
-   **Управление активной фигурой.** Хранит текущее активное тетрамино, позволяет осуществлять его перемещения, повороты, ускоренное перемещение вниз («hard drop») и использовать функцию «холда».
-   **Проверку и очистку заполненных рядов.** После завершения хода производится сканирование игрового поля, обнаружение заполненных рядов и их удаление, после чего обновляется счет посредством `ScoreManager`.
-   **Обработку состояний игры.** Реализует возможность постановки игры на паузу и возобновления игрового процесса.

#### 5. `ScoreManager.java`

Класс `ScoreManager` отвечает за подсчет очков и определение уровня игры:

-   **Подсчет очков.** При очистке строк начисляются очки в зависимости от количества одновременно удаленных рядов (1, 2, 3 или 4).
-   **Управление уровнем.** По мере накопления определенного количества очищенных линий происходит повышение уровня, что влияет на скорость игры.

#### 6. `LeaderboardsHandler.java`

Класс `LeaderboardsHandler` управляет таблицей рекордов, обеспечивая:

-   **Загрузку и сохранение рекордов.** Рекорды хранятся в файле `highscores.txt`, что позволяет сохранять результаты между запусками приложения.
-   **Добавление новых рекордов.** После завершения игры пользователь может ввести свое имя, и его результат будет добавлен в таблицу.
-   **Сортировку и ограничение записей.** Список результатов сортируется по убыванию очков, а количество записей ограничивается до 20 самых высоких результатов.

----------

### Пакет `tetris.gui`

Пакет `tetris.gui` отвечает за графический интерфейс и обработку пользовательского ввода. Его компоненты обеспечивают визуальное отображение игры, меню, таблицы рекордов и справочную информацию.

#### 1. `TetrisKeyListener.java`

Класс `TetrisKeyListener` расширяет `KeyAdapter` и реализует обработку событий с клавиатуры:

-   **Управление фигурой.** Клавиши `A` и `D` перемещают фигуру влево и вправо, `W` осуществляет поворот по часовой стрелке, `S` — ускоренное перемещение вниз, а `SPACE` выполняет «hard drop».
-   **Функция «холд».** При нажатии `SHIFT` текущая фигура перемещается в резерв, а активной становится следующая фигура из очереди.
-   **Пауза игры.** Нажатие клавиши `P` переводит игру в режим паузы.

#### 2. `MenuScreen.java`

Класс `MenuScreen` организует главное меню приложения, которое включает:

-   **Окно меню.** Внутренний класс `MenuWindow` создает окно с графическим оформлением и набором кнопок.
-   **Кнопки меню.** В меню доступны команды «New Game», «High Scores», «About» и «Exit», каждая из которых реализована с помощью отдельных кнопок с графическими эффектами (изображения по умолчанию и при наведении).

#### 3. `HighscoreScreen.java`

Класс `HighscoreScreen` предназначен для отображения таблицы рекордов:

-   **Окно таблицы рекордов.** Внутренний класс `HighscoreWindow` создает окно, в котором с помощью панели `HighscorePanel` выводится список лучших результатов.
-   **Возврат в меню.** На экране присутствует кнопка, позволяющая вернуться в главное меню.

#### 4. `GameScreen.java`

Класс `GameScreen` представляет основное игровое окно и включает в себя два ключевых компонента:

-   **GameWindow.** Окно, в котором происходит сам игровой процесс. Здесь создаются объекты `GameField` (логика игры) и `GamePanel` (отображение игры). Также организован таймер, регулирующий скорость падения фигур и динамику игры.
-   **GamePanel.** Панель для отрисовки элементов игры:
    -   Отображается игровое поле, текущая фигура, «ghost»-версия фигуры (прозрачная подсказка), фигура в режиме «холд» и превью следующих фигур.
    -   Реализовано обновление и вывод информации о счете и уровне.
    -   В случае паузы отображается соответствующий экран, а элементы управления временно отключаются.

При окончании игры в `GameWindow` запускается диалог ввода имени для записи результата в таблицу рекордов, после чего происходит переход обратно в главное меню.

#### 5. `AboutScreen.java`

Класс `AboutScreen` обеспечивает отображение справочной информации об игре:

-   **Окно справки.** Внутренний класс `AboutWindow` создает окно, где с помощью панели `AboutPanel` выводится графический фон и, при необходимости, другая информация.
-   **Возврат в меню.** Предусмотрена кнопка для выхода из справки и возвращения в главное меню.

#### 6. `ImageLoader.java`

Утилитный класс `ImageLoader` предоставляет статический метод `loadImage` для загрузки изображений:

-   **Загрузка ресурсов.** Метод обеспечивает загрузку графических файлов, необходимых для отрисовки игровых объектов и элементов интерфейса.
-   **Обработка ошибок.** В случае отсутствия файла или ошибки загрузки генерируется исключение, что помогает обнаружить проблемы с ресурсами на раннем этапе.

----------

## Общая архитектура и принципы реализации

Реализация игры «Тетрис» демонстрирует применение паттерна проектирования **MVC**:

-   **Model (Модель).** Пакет `tetris.model` содержит классы, отвечающие за логику игры, управление игровым полем, очередностью фигур, подсчет очков и ведение таблицы рекордов.
-   **View (Представление).** Пакет `tetris.gui` реализует графический интерфейс, отвечая за отрисовку игрового поля, меню, таблицы рекордов и справочной информации.
-   **Controller (Контроллер).** Механизмы управления игрой (например, класс `TetrisKeyListener`) осуществляют связь между моделью и представлением, обрабатывая ввод пользователя и обновляя состояние игры.

Такое четкое разделение логики и визуального представления не только улучшает читаемость и поддержку кода, но и упрощает внесение изменений, тестирование и дальнейшее расширение функциональности приложения.
